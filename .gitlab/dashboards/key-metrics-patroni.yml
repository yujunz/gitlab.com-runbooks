# WARNING. DO NOT EDIT THIS FILE BY HAND. USE ./scripts/generate-gitlab-dashboards.sh TO GENERATE IT
# YOUR CHANGES WILL BE OVERRIDDEN
dashboard: Key Services -  patroni
panel_groups:
- group: Key Services - patroni
  panels:
  - title: 'Latency: Apdex'
    metrics:
    - id: line-chart-latency-apdex-patroni-service
      label: "{{type}} Service"
      query_range: >-
        avg(avg_over_time(gitlab_service_apdex:ratio{environment="gprd", type="patroni", stage="main"}[1m]))
        by (type)
      unit: "%"
    type: line-chart
    y_label: Apdex %
  - title: Error Ratios
    metrics:
    - id: line-chart-patroni-service-error-ratios
      label: "{{type}} Service"
      query_range: >-
        avg(avg_over_time(gitlab_service_errors:ratio{environment="gprd", type="patroni", stage="main"}[1m]))
        by (type)
      unit: "%"
    type: line-chart
    y_label: "% Requests in Error"
  - title: RPS - Service Requests per Second
    metrics:
    - id: line_chart_rps_patroni_service_normal
      label: "{{type}} service"
      query_range: >-
        sum(avg_over_time(gitlab_service_ops:rate{environment="gprd", type="patroni", stage="main"}[1m]))
        by (type)
      unit: "%"
    - id: line_chart_rps_patroni_service_upper_limit
      label: upper limit
      query_range: |
        gitlab_service_ops:rate:prediction{environment="gprd", type="patroni", stage="main"}
        +
        3 * gitlab_service_ops:rate:stddev_over_time_1w{environment="gprd", type="patroni", stage="main"}
      unit: "%"
    - id: line_chart_rps_patroni_service_lower_limit
      label: lower limit
      query_range: |
        gitlab_service_ops:rate:prediction{environment="gprd", type="patroni", stage="main"}
        -
        3 * gitlab_service_ops:rate:stddev_over_time_1w{environment="gprd", type="patroni", stage="main"}
      unit: "%"
    type: anomaly-chart
    y_label: Operations per Second
  - title: Saturation
    metrics:
    - id: line-chart-patroni-service-cpu-component-saturation
      label: component
      query_range: >-
        max(max_over_time(gitlab_component_saturation:ratio{environment="gprd", type="patroni", stage="main"}[1m]))
        by (component)
      unit: "%"
    type: line-chart
    y_label: Saturation %
